# 4d-presentation-2025-09-25

* 01 - WP_SemanticSearch
* 02 - SemanticImageFiltering
* 03 - AI 4D Customers Similarities detection

`PROJECT`と同階層にある`OpenAI.token`ファイルにOpen AIのAPIキーを登録してください。

4D 20 R10の**ベータ版**は[7月10日](https://blog.4d.com/ja/4d-20-r10-beta-starts-today/)に開始し，10月第1週のリリースに向けて順調に準備が進められてきました。**公式ブログ**には，[R10のタグ記事](https://blog.4d.com/tag/20-r10/)が19個，[例題](https://github.com/4D-JP/HDI/releases/tag/20r10)が14個が公開されています。[フォーラム](https://discuss.4d.com/c/beta/13)で特に反響が多く寄せられている新機能は①AI連携と②ORDAイベントです。

R10では，新しいタイプのオブジェクト，[ベクター型](https://blog.4d.com/ja/4d-ai-discover-the-power-of-4d-vectors/)が使えます。使い方はとても簡単で，埋め込みに変換したいピクチャまたはテキストをAIKitコンポーネントに渡せば，OpenAIからベクターが返されます。同じコードで，OpenAIの代わりにOllamaを使うこともできます。埋め込みが返されたら，あとは4Dでベクトル同士を比較することができます。もっとも多用される埋め込みの計算は，コサイン類似度で，セマンティック検索や画像認識に使われます。ドット積は，ベクトルの方向性だけでなく、強さも計るもので，推薦システムに使われます。ユークリッド距離は，ベクターが空間の中でどれだけ離れているかを示すもので異常検知に使われます。

R10では，[Qodly Pro](https://blog.4d.com/ja/4d-qodly-pro-whats-new-in-4d-20-r10/)にも改良が施されています。まず，4Dと同じくR9から，QodlyでもHTTP Handlerが設定できるようになりましたが，この設定画面がより直感的で使い易いものになりました。さらに，ブラウザのタブとお気に入りに表示されるページ名や，URLの各部にアクセスするための名前空間ができました。4Dのサブフォームに相当するマトリックコンポーネントのデータソースをクエリなどで更新した場合，直後にどの行を選択するのか，どこまでスクロールするのか，しないのか，というプロパティも追加されています。また，日付ピッカーコンポーネントも改良されています。検索窓コンポーネントの外観をカスタマイズできるようになり，ネットワーク接続が失われたり，回復したりしたときには画面上に通知が表示されるようになりました。

R10では，[コンポーネント依存関係マネージャーにバージョン情報を再帰的に解析する仕組み](https://blog.4d.com/ja/recursive-dependency-management-smarter-deeper-safer/)が追加されています。また，フォームオブジェクトのデータソース（変数または式）は，ポインター経由でしか設定できないという制約がなくなり，[どんなフォーミュラでもバインドできる](https://blog.4d.com/ja/building-forms-on-the-fly-with-new-data-source-commands/)ようになりました。多くのデベロッパーから要望のあった，この改良により，ORDAがさらに使いやすくなりました。[エンティティのコンストラクターが定義できる](https://blog.4d.com/ja/orda-get-started-with-the-entity-constructor/)ようになった点も見逃せません。

R10では，[エンティティ属性のタッチイベントを処理できる](https://blog.4d.com/ja/orda-get-started-with-the-touched-event/)ようになりました。タッチは，属性に値が代入されたときに発火するイベントです。すべての属性，あるいは特定の属性のタッチイベントを実装することができます。フォームイベントのOn Data Changeにいくらか似ていますが，ランタイムレベルで一元的にロジックが適用される点が優れています。ORDAの計算属性にも似ていますが，必要最小限の再計算で済む点，バックエンドはストレージ属性なので，インデックスが利用できる点が優れています。

4D Internet Commandsを使わずに，標準のコマンドだけでネットワーク処理をサポートするために進められてきた作業もいろいろ大詰めとなりました。もちろん，単に置き換えるだけでなく，性能を上げることに主眼が置かれています。まずはTCPに注目したいと思います。R8ではTCPクライアント，R9ではTCPサーバーが追加されました。4D Internet CommandsでいうところのTCP Open，TCP Listenです。Internet Commandsとは違い，非同期処理なので，タイムアウトを特に設定しなくても処理がブロックされるわけではありませんが，デベロッパーからの要望に応え，R10ではタイムアウトが設定できるようになりました。4D Internet Commandsと比較した場合，現時点でTCPクラスに足りないのはTLSだけです。ローレベルTCPの暗号化は，バージョン21で提供される予定となっています。

R10では，4D Internet Commandsを使わずとも[UDP](https://blog.4d.com/ja/new-class-to-perform-udp-communications/)が使えます。小出しだったTLSとは違い，クライアントとサーバーの両方が一挙に実装されました。言うまでもなく，オブジェクト指向，非同期通信であり，プリエンプティブモードに対応しています。HTTPクラス，システムワーカークラス，TCPクラス，WebSocketクラス，UDPクラスは，どれも仕様がとても良く似ているので，ひとつ憶えれば，全部が使えるようになります。AIKitも，裏ではHTTPクラスの非同期通信を使っているので，ぜひ，この設計に慣れていただければと思います。

R10では，[シンタックスチェック](https://blog.4d.com/ja/stricter-class-based-typing-for-objects/)がさらに強化され，オブジェクト型のアップキャストやダウンキャストもチェックするようになりました。さらに，ストラクチャーエディターのインスペクターでオブジェクト型フィールドのクラス名を設定することができます。こうした改良により，ORDAのようなオブジェクト指向プログラミングがいっそう快適になりました。

R10では，デベロッパーからの要望に応え，[UUID（汎用一識別子）バージョン7](https://blog.4d.com/ja/sort-uuids-with-version-7/)が利用できるようになりました。また，ベータ期間中に寄せられたフィードバックを受け止め，デフォルトの仕様はこれまでどおりバージョン4で，どちらのバージョンを使用するのかは設定で決められるようになっています。

R10では，NetKitで[予定の追加・更新・削除ができる](https://blog.4d.com/ja/managing-calendar-events-with-microsoft-365-or-google-in-4d-create-update-delete/)ようになりました。どちらのカレンダーにも同じ要領でアクセスすることができます。いずれも公式のOAuth APIを呼び出しているので，自動的にデータがシンクロされ，デバイスに通知されるというメリットがあります。

R10では，[アプリケーションビルドのライセンス選択画面](https://blog.4d.com/ja/embed-deployment-license-automatically-into-your-applications/)が改良されました。配付ライセンスファイルを特に指定せずにビルドをした場合，埋め込みなしとみなされ，初回のアプリケーション起動時に4D Server買い切りライセンス，あるいは，4D Desktopか4D Serverのサブスクライセンスを入力する画面が表示されます。評価版アプリケーションを選択した場合，やはり埋め込みなしアプリケーションがビルドされますが，info.plistファイルに特別なキーが追加され，初回のアプリケーション起動時に14日間有効の評価ライセンスがアプリケーションの4Dフォルダーにダウンロードされます。評価期間が過ぎた後は，ライセンス入力画面が表示されるようになります。バージョンに対応する埋め込みライセンスは，4D Developerのバージョンに合わせて埋め込みライセンスを選択するというオプションで，4D Desktop Businessまたは4D OEM Desktopが対象です。過去バージョンの仕様も選択肢として残されています。
